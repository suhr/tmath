# Синтаксис

Мы будем описывать формальные системы, а любая формальная система начинается с синтаксиса.
Синтаксис описывается с помощью грамматики.

Рассмотрим на примере. Пусть мы описываем синтаксис арифметических выражений:

- Числа (например, $1$, $-3$, $42$) это выражения
- Если ${\color{red} a}$ и ${\color{red} b}$ это выражения, то и ${\color{red} a} + {\color{red} b}$
это выражение
- Если ${\color{red} a}$ и ${\color{red} b}$ это выражения, то и ${\color{red} a} - {\color{red} b}$ это выражение
- Если ${\color{red} a}$ и ${\color{red} b}$ это выражения, то и ${\color{red} a} × {\color{red} b}$ это выражение
- Если ${\color{red} a}$ и ${\color{red} b}$ это выражения, то и ${\color{red} a} ÷ {\color{red} b}$
это выражение
- Если ${\color{red} e}$ это выражение, то и $({\color{red}e})$ это выражение

Такие последовательности символов соответствуют описанию:

- $-5 + 2×4$
- $(12 + 3)×(13 - 4)$
- $(((1)+((2))) ÷ 3)$

А такие — нет:

- $+9$
- $)4-7($
- $2 + (÷)$

Компактно, эта грамматика описывается следующим образом:

$$\begin{aligned}
{\color{red}expr} ::=\ &\textcolor{red}{num} & &\text{(число)} \\
\mid\quad &{\color{red}expr}\ {+}\ {\color{red}expr} & &\text{(сложение)} \\
\mid\quad &{\color{red}expr}\ {-}\ {\color{red}expr} & &\text{(вычитание)} \\
\mid\quad &{\color{red}expr}\ {×}\ {\color{red}expr} & &\text{(умножение)} \\
\mid\quad &{\color{red}expr}\ {÷}\ {\color{red}expr} & &\text{(деление)} \\
\mid\quad &{(}\, {\color{red}expr}\, ) & &\text{(скобки)} \\
\end{aligned}$$

Эту запись можно понимать двояко — как правила того, как строить синтаксически корректные выражения, или же как правила разбора выражения на состовляющие.

Если мы рассматриваем грамматику как правила порождения выражения, то мы подставляем на место ${\color{red}expr}$ одно из выражений в правой части грамматики, а на место ${\color{red}num}$ подставляем число. Повторяем до тех пор, когда в выражении больше не останется синтаксических переменных.

Например:

- ${\color{red}expr}$
- ${\color{red}expr} - {\color{red}expr}$
- ${\color{red}expr}÷{\color{red}expr} - {\color{red}num}$
- ${\color{red}num}÷{\color{red}num} - 1$
- $3÷2 - 1$

Если мы наоборот, рассматриваем грамматику как правила разбора выражения, то тогда мы сопоставляем
выражения с грамматикой, вводя новые синтаксические переменные:

- $3÷2 - 1$ это ${\color{red}a} - {\color{red}b}$, где ${\color{red}a}$ это $3÷2$, а ${\color{red}b}$ это $1$
    - $3÷2$ это ${\color{red}l} - {\color{red}r}$, где ${\color{red}l}$ это $3$, а ${\color{red}r}$ это $2$
        - $3$ — число
        - $2$ — число
    - $1$ — число

Разобранное выражение можно представить в виде диаграммы:

![](/_img/syn1.svg)

Это *синтаксическое дерево*. Деревья в информатике рисуются сверху вниз, с корнем наверху и с листьями внизу.

Мы разобрали выражение определённым образом, но используя эту грамматику можно разобрать то же самое выражение иначе:

![](/_img/syn2.svg)

Грамматика, которая допускает различный разбор одного и того же выражения называется неоднозначной.

Мы могли бы преобразовать грамматику в эквивалентную ей однозначную грамматитку, которая разбирает или порождает те же строки, что и первоначальная грамматика. Но мы этого делать не будем, так как нас интересуют не строки (последовательности символов), а синтаксические деревья.

Вместо этого, мы отдельно будем оговаривать, как интерпретировать выражения. Кроме того, мы не будем писать правило для скобок в грамматике, подразумевая, что круглые скобки всегда испльзуются для группировки.

Подстановка выражения на место синтаксической переменной означает подстановку в соответствующее место синтаксического дерева. При этом, выражение может оборачиваться в скобки при необходимости.

Скажем, подставив $31-12$ на место ${\color{red}x}$ в $2×{\color{red}x}$, получаем $2×(31 - 12)$.

У описываемого языка могут быть свои переменные, которые никак не связаны с синтаксическими переменными. Например, добавим переменные к граматике арифметических выражений:

$$\begin{aligned}
{\color{red}expr} ::=\ &\textcolor{red}{num} & &\text{(число)} \\
\mid\quad &{\color{red}var} & &\text{(переменная)} \\
\mid\quad &{\color{red}expr}\ {+}\ {\color{red}expr} & &\text{(сложение)} \\
\mid\quad &{\color{red}expr}\ {-}\ {\color{red}expr} & &\text{(вычитание)} \\
\mid\quad &{\color{red}expr}\ {×}\ {\color{red}expr} & &\text{(умножение)} \\
\mid\quad &{\color{red}expr}\ {÷}\ {\color{red}expr} & &\text{(деление)} \\
\end{aligned}$$

Теперь грамматика описывает также выражения вроде $2×(y-1) + x$.

Всюду, где переменные языка можно спутать с синтаксическим переменными (которые также называюся *метапеременными*), мы используем красный цвет для метапеременных.

Скажем, мы можем разобрать $2×(y-1) + x$ как ${\color{red}x} + {\color{red}y}$, где ${\color{red}x}$ это $2×(y-1)$, а ${\color{red}y}$ это $x$. При этом, путаницы между ${\color{red}x}$ и $x$ не возникает.

Кроме метапеременных бывают также и метавыражения — преобразования одного синтаксического дерева в другое. Мы их отдельно не выделяем. Точно так же мы не будем выделять отношения, не являющиеся частью языка.
